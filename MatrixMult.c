// Gemima Lydie Wembalonge
// Final Project: Matrix Mutliplication
// Operating Systems (Comp 3400-01)
// Professor Mohammed Anwaruddin
// Wentworth Institute of Technology
// 12/06/2019

#include <stdio.h>
#include<stdlib.h>
#include<pthread.h>
#define nk 20 //global space
#define m 20
#define n 20
float a[m][nk] = { {1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},
    {1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4} };
float b[nk][n] = { {1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},
    {1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4},{1,1,1,5,4,3,6,555,4,3,2,1,3,4,5,6,7,6,5,4} };
float c[m][n] = { 0 };

typedef struct {
    int i; /* Row */
    int j; /* Column */
} Params;

void* threadfun(void* arg) // each thread
{
    Params* p = (Params*)arg;
    int k, tmp;
    for (k = 0; k < nk; k++) {
        tmp = a[p->i][k];
        c[p->i][p->j] = c[p->i][p->j] + tmp * b[k][p->j];
    }
    return NULL;
}
int main(void) {
    int i, j;
    pthread_t tid[m * n];
    int kt = 0;
    for (int i = 0; i < m; i++) {
        for (int j = 0; j < n; j++) {
            Params* data = (Params*)malloc(sizeof(Params));
            data->i = i;
            data->j = j;
            pthread_create(&tid[kt], NULL, &threadfun, (data));
            pthread_join(tid[i], NULL);
            kt++;
            free(data);
        }
    }
    FILE* fMatMultData;
    fMatMultData = fopen("MatrixM.txt", "w");
    for (i = 0; i < m; i++) {
        for (j = 0; j < n; j++) {
            printf("%f\t", c[i][j]);
            fprintf(fMatMultData, "%f\t", c[i][j]);
            
        }
        fprintf(fMatMultData, "\n");
        printf("\n");
    }
    fclose(fMatMultData);
    return 0;
}
